# Kibana config for SOC1 – preconfigured Fleet + policies

server.host: "0.0.0.0"
server.publicBaseUrl: "http://{{ inventory_hostname }}:5601"

elasticsearch.hosts: ["https://es01:9200"]
elasticsearch.username: "elastic"
elasticsearch.password: "{{ elastic_password }}"
elasticsearch.ssl.certificateAuthorities: ["/usr/share/kibana/config/http_ca.crt"]

xpack.encryptedSavedObjects.encryptionKey: "{{ xpack_encryptedSavedObjects_encryptionKey }}"
xpack.security.encryptionKey: "{{ xpack_security_encryptionKey }}"
xpack.reporting.encryptionKey: "{{ xpack_reporting_encryptionKey }}"

xpack.security.authc.api_key.enabled: true

######################################################################
# Fleet preconfiguration – packages and policies
######################################################################

xpack.fleet.packages:
  - name: fleet_server
    version: latest
  - name: system
    version: latest
  - name: zeek
    version: latest
  - name: winlog
    version: latest

xpack.fleet.agentPolicies:
  ####################################################################
  # 1. Fleet Server policy – control plane only
  ####################################################################
  - name: Fleet Server policy
    id: fleet-server-policy
    namespace: soc
    monitoring_enabled: [logs, metrics]
    package_policies:
      - name: fleet-server-1
        package:
          name: fleet_server
        namespace: soc
      - name: fleet-server-system
        package:
          name: system
        namespace: soc
        inputs:
          system-logfile:
            enabled: true
            streams:
              "[system.auth]":
                enabled: true
                vars:
                  paths:
                    - /var/log/secure*
                    - /var/log/auth.log*
                  tags: ["fleet-server", "soc"]
              "[system.syslog]":
                enabled: true
                vars:
                  paths:
                    - /var/log/messages*
                    - /var/log/syslog*
                  tags: ["fleet-server", "soc"]
          system-system/metrics:
            enabled: true
            streams:
              "[system.core]":
                enabled: true
                vars:
                  period: 20s

  ####################################################################
  # 2. SOC1 Zeek sensor – network telemetry only
  ####################################################################
  - name: SOC1 Zeek sensor policy
    id: soc1-zeek-policy
    namespace: soc
    monitoring_enabled: [logs, metrics]
    package_policies:
      - name: soc1-zeek
        package:
          name: zeek
        namespace: soc
        id: soc1-zeek-1
        inputs:
          zeek-logfile:
            enabled: true
            vars:
              base_paths:
                - /opt/zeek/logs/current   # change if your Zeek logs path is different
            streams:
              "[zeek.connection]":
                enabled: true
                vars:
                  filenames: [conn.log]
                  preserve_original_event: true
              "[zeek.dns]":
                enabled: true
                vars:
                  filenames: [dns.log]
              "[zeek.files]":
                enabled: true
                vars:
                  filenames: [files.log]
              "[zeek.http]":
                enabled: true
                vars:
                  filenames: [http.log]
                  preserve_original_event: true
              "[zeek.notice]":
                enabled: true
                vars:
                  filenames: [notice.log]
              "[zeek.weird]":
                enabled: true
                vars:
                  filenames: [weird.log]
              "[zeek.ssh]":
                enabled: true
                vars:
                  filenames: [ssh.log]
              "[zeek.rdp]":
                enabled: true
                vars:
                  filenames: [rdp.log]

  ####################################################################
  # 3. SOC1 host – SOC1 Linux logs + metrics
  ####################################################################
  - name: SOC1 system policy
    id: soc1-system-policy
    namespace: soc
    monitoring_enabled: [logs, metrics]
    package_policies:
      - name: soc1-system
        package:
          name: system
        namespace: soc
        id: soc1-system-1
        inputs:
          system-logfile:
            enabled: true
            streams:
              "[system.auth]":
                enabled: true
                vars:
                  paths:
                    - /var/log/secure*
                    - /var/log/auth.log*
                  tags: ["soc1", "soc", "system-auth"]
              "[system.syslog]":
                enabled: true
                vars:
                  paths:
                    - /var/log/messages*
                    - /var/log/syslog*
                  tags: ["soc1", "soc", "system-syslog"]
          system-system/metrics:
            enabled: true
            streams:
              "[system.core]":
                enabled: true
                vars:
                  period: 20s

  ####################################################################
  # 4. Linux core – baseline policy for Rocky/Ubuntu VMs
  ####################################################################
  - name: Linux core policy
    id: linux-core-policy
    namespace: lab
    monitoring_enabled: [logs, metrics]
    package_policies:
      - name: linux-core-system
        package:
          name: system
        namespace: lab
        id: linux-core-system-1
        inputs:
          system-logfile:
            enabled: true
            streams:
              "[system.auth]":
                enabled: true
                vars:
                  paths:
                    - /var/log/secure*
                    - /var/log/auth.log*
                  tags: ["linux-core", "system-auth"]
              "[system.syslog]":
                enabled: true
                vars:
                  paths:
                    - /var/log/messages*
                    - /var/log/syslog*
                  tags: ["linux-core", "system-syslog"]
          system-system/metrics:
            enabled: true
            streams:
              "[system.core]":
                enabled: true
                vars:
                  period: 20s

  ####################################################################
  # 5. Windows core – baseline Windows logs (advanced policy added later)
  ####################################################################
  - name: Windows core policy
    id: windows-core-policy
    namespace: windows
    monitoring_enabled: [logs, metrics]
    package_policies:
      - name: windows-core-logs
        package:
          name: winlog
        namespace: windows
        id: windows-core-logs-1
        inputs:
          winlogs-winlog:
            enabled: true
            streams:
              "[winlog.application]":
                enabled: true
                vars:
                  tags: ["windows-core", "application"]
              "[winlog.system]":
                enabled: true
                vars:
                  tags: ["windows-core", "system"]
              "[winlog.security]":
                enabled: true
                vars:
                  tags: ["windows-core", "security"]

